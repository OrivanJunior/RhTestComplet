uses CommonsAll, CommonsObj, VarConsts,ObjDarfs, DataPoolDarfs;

procedure PreencheDarfs();
begin
VerificaConsultaF3Insere(_ModuloFolha,CadDarfsEBEstab,CadDarfsDPEstab);  		
PreencheDatas (CadDarfsEBDataVenc,CadDarfsDPDataVenc);
VerificaInsere(CadDarfsEBCodReceita,CadDarfsDPCodReceita);
VerificaInsere(CadDarfsEBSequencia,CadDarfsDPSequencia);
PreencheDatas (CadDarfsEBDataApur,CadDarfsDPDataApur);
VerificaInsere(CadDarfsEBIdentifica,CadDarfsDPIdentifica);
VerificaInsere(CadDarfsEBNroReferencia, CadDarfsDPNroReferencia);
VerificaInsere(CadDarfsEBVlrPrincipal, CadDarfsDPVlrPrincipal);
VerificaInsere(CadDarfsEBVlrMulta,CadDarfsDPVlrMulta);
VerificaInsere(CadDarfsEBVlrJuros,CadDarfsDPVlrJuros);
VerificaInsere(CadDarfsEBVlrTotal,CadDarfsDPVlrTotal);
end;

procedure CadastraDarfs();
var
DDTCadastrar : OleVariant;
begin
AcessaItem(_ModuloFolha, 'Cadastros Específicos', 'Darf''s');

MapGridConsulta(_ModuloFolha);

DDTCadastrar := CarregaDDT(pathData, _Cadastrar);

LeDataPoolCadAnuenios(DDTCadastrar.Name);

 if (FormTelaConsultaGrid.ActiveView.ViewData.RowCount = 1) then
    ValidaFormAberto(_ModuloFolha, 'FRhAnuenios');
  
  FiltraGrid(_ModuloFolha, 'FBRowseCds', 'BGrid', 'Tabela de Anuên',CadAnuenioDPIdTabanuenio);
  if (FormTelaConsultaGrid.ActiveView.ViewData.RowCount < 1) then
  begin
  
  ActIncluir(FormTelaConsultaForm);
  
  MapCadAnuenios();
  
  PreencheAnuenios();
  PreencheGridAnuenio(pathData);
  
  ActSalvar(FormPadraoAnuenios);
  ActFechar(FormPadraoAnuenios);
  end;
  ActFechar(FormTelaConsultaForm);
  DDT.CloseDriver(DDTCadastrar.Name);
end;

procedure ExcluirDarfs(PathData);
var
DDTExcluir : OleVariant;
begin
AcessaItem(_ModuloFolha, 'Cadastros Específicos', 'Anuênios');

MapGridConsulta(_ModuloFolha);

DDTExcluir := CarregaDDT(PathData, _Excluir);

LeDataPoolCadAnuenios(DDTExcluir.Name);

While not DDTExcluir.EOF do
begin

 if (FormTelaConsultaGrid.ActiveView.ViewData.RowCount = 1) then
    ValidaFormAberto(_ModuloFolha, 'FRhAnuenios');
  
  FiltraGrid(_ModuloFolha, 'FBRowseCds', 'BGrid', 'Tabela de Anuên',CadAnuenioDPIdTabanuenio);
  if (FormTelaConsultaGrid.ActiveView.ViewData.RowCount = 1) then
  begin  
  
  ActConsulta(FormTelaConsultaForm);
  
  MapCadAnuenios();
  
  ActSalvar(FormPadraoAnuenios);

  ActExcluir(_ModuloFolha, 'FRhAnuenios');

  ActFechar(FormPadraoAnuenios);
  end;
  DDTExcluir.Next;
end;
ActFechar(FormTelaConsultaForm);
DDT.CloseDriver(DDTExcluir.Name);
end;

