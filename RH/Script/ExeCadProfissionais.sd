uses
VarConsts,
CommonsAll,
CommonsObj,
DataPoolCadProfissionais,
ObjCadProfissionais;

var
  DDTProfissionais: OleVariant;

procedure AcessaCadProfissionais();
begin
  AcessaItem(_ModuloFolha, 'Cadastros Gerais', 'Profissionais');
end;

procedure FiltroCadastroProfissionais();
begin
MapFiltroCadProfissionais;
//FiltroConsFormCBSelCons.SelectFirst;
//FiltroConsFormCBSelCons.Keys('[Enter]');
FiltroConsCBSelCons('Profissional por Código');
FiltroConsCBCod.SelectItem('(Ignorar)');
BtnOkFiltroConsForm.ClickButton;
end;

procedure PreencheDadosCadastroProfissionais();
begin
VerificaInsere(CadProfissionaisEBId,CadProfissionaisDPId);	       
VerificaInsere(CadProfissionaisEBNome,CadProfissionaisDPNome);	        
VerificaInsere(CadProfissionaisEBEmail,CadProfissionaisDPEmail);	       
VerificaInsere(CadProfissionaisEBFiliacao,CadProfissionaisDPFiliacao);         
VerificaInsere(CadProfissionaisEBNacionalidade,CadProfissionaisDPNacionalidade);       
VerificaInsere(CadProfissionaisEBCpf,CadProfissionaisDPCpf);	       
VerificaInsere(CadProfissionaisEBNis,CadProfissionaisDPNis);	       
VerificaInsere(CadProfissionaisEBTipo,CadProfissionaisDPTipo);	       				 
VerificaInsere(CadGrpProfissionaisEBFormacao,CadGrpProfissionaisDPFormacao);      
VerificaInsere(CadGrpProfissionaisEBTpProfissional,CadGrpProfissionaisDPTpProfissional);      
VerificaConsultaF3Insere(CadGrpProfissionaisEBCbo,CadGrpProfissionaisDPCbo);      						 
VerificaInsere(CadGrpMedicosEBOrgao,CadGrpMedicosDPOrgao);      
VerificaInsere(CadGrpMedicosEBNumeroOrgao,CadGrpMedicosDPNumeroOrgao);  
VerificaConsultaF3Insere(CadGrpMedicosEBUforgao,CadGrpMedicosDPUforgao);  
VerificaInsere(CadGrpMedicosEBSiglaOrgao,CadGrpMedicosDPSiglaOrgao);
end;

{Cadastra}

procedure CadastraProfissionais(pathData);
//var
//  DDTProfissionais;
begin
  DDTProfissionais := CarregaDDT(pathData, _Cadastrar);

  AcessaItem(_ModuloFolha, 'Cadastros Gerais', 'Profissionais');
  
  FiltroCadastroProfissionais();
  
  {enquanto não for o fim do arquivo faça..}
  while not(DDTProfissionais.EOF) do
  begin
    LeDataPoolCadastroProfissionais(DDTProfissionais.Name);
  
    MapGridConsulta(_ModuloFolha);
  
    if (FormTelaConsultaGrid.ActiveView.ViewData.RowCount = 1) then
      ValidaFormAberto(_ModuloFolha, 'FRhProf');

    FiltraGrid(_ModuloFolha, 'FBRowseCds', 'BGrid', 'Código do Profi', CadProfissionaisDPId);
    if (FormTelaConsultaGrid.ActiveView.ViewData.RowCount < 1) then
    begin
      ActIncluir(FormTelaConsultaForm);
  
      MapCadProfissionais;
      if (CadChequesForm.Exists) then
      begin
        PreencherDados(); 
  
        ActSalvar(CadProfissionaisForm);
        ActFechar(CadProfissionaisForm);
      end;
    end;
    DDTProfissionais.Next;
  end;
  ActFechar(FormTelaConsultaForm);
  DDT.CloseDriver(DDTProfissionais.Name);
end;
  
{Altera}

procedure AlteraProfissionais(pathData);
//var
//  DDTProfissionais;
begin
  DDTProfissionais := CarregaDDT(pathData, _Alterar);
  
  AcessaItem(_ModuloFolha, 'Cadastros Gerais', 'Profissionais');
  
  FiltroCadastroProfissionais();
  
  while not(DDTProfissionais.EOF) do
  begin
    LeDataPoolCadastroProfissionais(DDTProfissionais.Name);
  
    MapGridConsulta(_ModuloFolha);
  
    if (FormTelaConsultaGrid.ActiveView.ViewData.RowCount = 1) then
    ValidaFormAberto(_ModuloFolha, 'FRhProf');
  
    FiltraGrid(_ModuloFolha, 'FBRowseCds', 'BGrid', 'Código do Profi', CadProfissionaisDPId);
    if (FormTelaConsultaGrid.ActiveView.ViewData.RowCount >= 1) then
    begin
      ActConsulta(FormTelaConsultaForm);
  
      MapCadProfissionais();
  
      if (CadProfissionaisForm.Exists) then
      begin
        PreencherDados(); 
  
        ActSalvar(CadProfissionaisForm);
        ActFechar(CadProfissionaisForm);
      end;
    end;
    DDTProfissionais.Next;
  end;
  ActFechar(FormTelaConsultaForm);
  DDT.CloseDriver(DDTProfissionais.Name);
end;

{Exclui}

procedure ExcluirProfissionais(pathData);
//var
//  DDTProfissionais;
begin
  DDTProfissionais := CarregaDDT(pathData, _Excluir);
  
  AcessaItem(_ModuloFolha, 'Cadastros Gerais', 'Profissionais');
  
  FiltroCadastroProfissionais();
  
  while not(DDTProfissionais.EOF) do
  begin
    LeDataPoolCadastroProfissionais(DDTProfissionais.Name);
  
    MapGridConsulta(_ModuloFolha);
  
    if (FormTelaConsultaGrid.ActiveView.ViewData.RowCount = 1) then
      ValidaFormAberto(_ModuloFolha, 'FRhProf');
  
    FiltraGrid(_ModuloFolha, 'FBRowseCds', 'BGrid', 'Código do Profi', CadProfissionaisDPId);
  
    if (FormTelaConsultaGrid.ActiveView.ViewData.RowCount = 1) then
    begin
      
      ActExcluir(_ModuloFolha, 'FBRowseCds');
      
    end;
    DDTProfissionais.Next;
  end;
  ActFechar(FormTelaConsultaForm);
  DDT.CloseDriver(DDTProfissionais.Name);
end;