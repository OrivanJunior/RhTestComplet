uses 
CommonsAll,
CommonsObj,
DataPoolComplementoDeFerias,
ObjComplementoDeFerias,
VarConsts;

procedure PreencheDatasProc(pathData);
var
DDTDados: OleVariant;
begin
DDTDados := CarregaDDT(pathData, 'Datas');

LeDataPoolCompFeriasData(DDTDados.Name);

MapCadProcCompFerias();

PreencheDatas(CadProcCompFeriasEBData,CadProcCompFeriasDPData);
PreencheDatas(CadProcCompFeriasEBDataPagto,CadProcCompFeriasDPDataPagto);
end;

procedure PreencheProcessoControl(pathData);
var
DDTProcesso : OleVariant;
begin
BtnbIncluirControle.ClickButton();

Delay(2000);

CadFormPageProcessoInfoNormais.ActivePageIndex := 0;
DDTProcesso := CarregaDDT(pathData, 'Processos');

LeDataPoolCompFeriasProcCtrl(DDTProcesso.Name);

MapCadProcCompFerias();

VerificaConsultaF3Insere(_ModuloFolha,CadIncProcCompFeriasEBEstab,CadIncProcCompFeriasDPEstab);
VerificaConsultaF3Insere(_ModuloFolha,CadIncProcCompFeriasEBIdProcesso,CadIncProcCompFeriasDPIdProcesso);
PreencheDatas(CadIncProcCompFeriasEBData,CadIncProcCompFeriasDPData);
PreencheDatas(CadIncProcCompFeriasEBCompIrrf,CadIncProcCompFeriasDPCompIrrf);
VerificaInsere(CadIncProcCompFeriasEBVlrArred,CadIncProcCompFeriasDPVlrArred);
VerificaInsere(CadIncProcCompFeriasEBEmAberto,CadIncProcCompFeriasDPEmAberto);
VerificaInsere(CadIncProcCompFeriasEBIdeDmDev,CadIncProcCompFeriasDPIdeDmDev);

if (Aliases.Folha.FRhProcesso.BSalvarRap.Enabled = true) then
begin
BtnIncProcSave.Click;
BtnIncProcEBSair.Click;
end
else
BtnIncProcEBSair.Click;
end;


procedure PreencheMovimento(pathData);
var
DDTMovimento : OleVariant;
begin
MapCadMovCompProcFerias();

DDTMovimento := CarregaDDT(pathData, 'Movimento');

while not DDTMovimento.EOF do
begin
FormpgMovCompProcFerias.ActivePageIndex := 1;

BtnCompProcFeriasbMovInc.Click;

MapCadMovCompProcFerias();
LeDataPoolCompFeriasMov(DDTMovimento.Name);

Log.Checkpoint('PreenchendoMovimento');

VerificaConsultaF3Insere(_ModuloFolha,CadMovCompProcFeriasEBEstab,CadMovCompProcFeriasDPEstab);  			
VerificaConsultaF3Insere(_ModuloFolha,CadMovCompProcFeriasEBIdProcesso,CadMovCompProcFeriasDPIdProcesso);  	    
PreencheDatas(CadMovCompProcFeriasEBData,CadMovCompProcFeriasDPData); 
VerificaConsultaF3Insere(_ModuloFolha,CadMovCompProcFeriasEBIdEvento,CadMovCompProcFeriasDPIdEvento); 
VerificaConsultaF3Insere(_ModuloFolha,CadMovCompProcFeriasEBIdEmpregado,CadMovCompProcFeriasDPIdEmpregado); 
VerificaInsere(CadMovCompProcFeriasEBComplementaFerias,CadMovCompProcFeriasDPComplementaFerias); 
VerificaInsere(CadMovCompProcFeriasEBIdSistemaExp,CadMovCompProcFeriasDPIdSistemaExp);

MapCadMovCompProcFerias();
CadMovCompProcFeriasEBIdEvento.Keys('[Enter]');

CadPgParamCompProcFerias.ActivePageIndex := 0;

Log.Checkpoint('Prenchendo Parametros');

VerificaInsere(CadParamCompProcFeriasEBInforme,CadParamCompProcFeriasDPInforme);
VerificaInsere(CadParamCompProcFeriasEBReferencia,CadParamCompProcFeriasDPReferencia);
VerificaInsere(CadParamCompProcFeriasEBPropbasehoras,CadParamCompProcFeriasDPPropbasehoras);

BtnSaveMovParamCompProcFerias.Click;

DDTMovimento.Next;
end;
DDT.CloseDriver(DDTMovimento.Name);
end;

procedure PreencheParametros(pathData);
var
DDTParametros : OleVariant;
begin
MapCadMovCompProcFerias();

CadPgParamCompProcFerias.ActivePageIndex := 0;

DDTParametros := CarregaDDT(pathData, 'Parametros');

LeDataPoolCompFeriasParam(DDTParametros.Name);

Log.Checkpoint('Prenchendo Parametros');

VerificaInsere(CadParamCompProcFeriasEBInforme,CadParamCompProcFeriasDPInforme);
VerificaInsere(CadParamCompProcFeriasEBReferencia,CadParamCompProcFeriasDPReferencia);
VerificaInsere(CadParamCompProcFeriasEBPropbasehoras,CadParamCompProcFeriasDPPropbasehoras);

BtnSaveMovParamCompProcFerias.Click;

DDT.CloseDriver(DDTParametros.Name);
end;

procedure PreencheEmpregado(pathData);
var
DDTEmpregado : Olevariant;
i;
begin
i := 0;

MapCadEmpregadoCompFerias();

CadFormpgEmpCompProcFerias.ActivePageIndex := 0;

//DDTEmpregado := CarregaDDT(pathData, 'Empregado');

CadEmpCompProcFeriasbEmpreIncAll.Click;

//LeDataPoolEmpregadoGrid(DDTEmpregado.Name);
//
//CadEmpCompProcFeriasbEmpreInc.Click;
//
//VerificaClickPreencheGrid(CadEmpCompProcFeriasGrid, i, 'Empregado', CadEmpregadoCompFerias);
//CadFormpgEmpCompProcFerias.Click;
//CadEmpCompProcFeriasbEmpreSave.Click;

end;

procedure ExecutaProcCompFerias(pathData);
var
BtnOk;
begin

AcessaItem(_ModuloFolha, 'Processamentos', 'Complemento de Férias');

PreencheDatasProc(pathData);
PreencheProcessoControl(pathData);
PreencheEmpregado(pathData);
PreencheMovimento(pathData);

MapCadProcCompFerias();

BtnbExecutarProcFerias.Click();

BtnSalvarProcFerias.Click;

if Aliases.Folha.dlgConfirma_o.Exists then
begin
 BtnOk := Aliases.Folha.dlgConfirma_o.btnOK;
 BtnOk.ClickButton;
end;
  
ActFechar(CadFormProcCompFerias);

end;

